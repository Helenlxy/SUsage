(function(factory){if(typeof window.define==='function'){if(window.define.amd){window.define('wangEditor',["jquery"],factory)}else if(window.define.cmd){window.define(function(require,exports,module){return factory})}else{factory(window.jQuery)}}else if(typeof module==="object"&&typeof module.exports==="object"){window.wangEditorCssPath?require(window.wangEditorCssPath):require('../css/wangEditor.css');module.exports=factory(window.wangEditorJQueryPath?require(window.wangEditorJQueryPath):require('jquery'))}else{factory(window.jQuery)}})(function($){if(!$||!$.fn||!$.fn.jquery){alert('在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor');return}var _e=function(fn){var E=window.wangEditor;if(E){fn(E,$)}};(function(window,$){if(window.wangEditor){alert('一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！');return}var E=function(elem){if(typeof elem==='string'){elem='#'+elem}var $elem=$(elem);if($elem.length!==1){return}var nodeName=$elem[0].nodeName;if(nodeName!=='TEXTAREA'&&nodeName!=='DIV'){return}this.valueNodeName=nodeName.toLowerCase();this.$valueContainer=$elem;this.$prev=$elem.prev();this.$parent=$elem.parent();this.init()};E.fn=E.prototype;E.$body=$('body');E.$document=$(document);E.$window=$(window);E.userAgent=navigator.userAgent;E.getComputedStyle=window.getComputedStyle;E.w3cRange=typeof document.createRange==='function';E.hostname=location.hostname.toLowerCase();E.websiteHost='wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me';E.isOnWebsite=E.websiteHost.indexOf(E.hostname)>=0;E.docsite='http://www.kancloud.cn/wangfupeng/wangeditor2/113961';window.wangEditor=E;E.plugin=function(fn){if(!E._plugins){E._plugins=[]}if(typeof fn==='function'){E._plugins.push(fn)}}})(window,$);_e(function(E,$){E.fn.init=function(){this.initDefaultConfig();this.addEditorContainer();this.addTxt();this.addMenuContainer();this.menus={};this.commandHooks()}});_e(function(E,$){E.fn.ready=function(fn){if(!this.readyFns){this.readyFns=[]}this.readyFns.push(fn)};E.fn.readyHeadler=function(){var fns=this.readyFns;while(fns.length){fns.shift().call(this)}};E.fn.updateValue=function(){var editor=this;var $valueContainer=editor.$valueContainer;var $txt=editor.txt.$txt;if($valueContainer===$txt){return}var value=$txt.html();$valueContainer.val(value)};E.fn.getInitValue=function(){var editor=this;var $valueContainer=editor.$valueContainer;var currentValue='';var nodeName=editor.valueNodeName;if(nodeName==='div'){currentValue=$valueContainer.html()}else if(nodeName==='textarea'){currentValue=$valueContainer.val()}return currentValue};E.fn.updateMenuStyle=function(){var menus=this.menus;$.each(menus,function(k,menu){menu.updateSelected()})};E.fn.enableMenusExcept=function(menuIds){if(this._disabled){return}menuIds=menuIds||[];if(typeof menuIds==='string'){menuIds=[menuIds]}$.each(this.menus,function(k,menu){if(menuIds.indexOf(k)>=0){return}menu.disabled(false)})};E.fn.disableMenusExcept=function(menuIds){if(this._disabled){return}menuIds=menuIds||[];if(typeof menuIds==='string'){menuIds=[menuIds]}$.each(this.menus,function(k,menu){if(menuIds.indexOf(k)>=0){return}menu.disabled(true)})};E.fn.hideDropPanelAndModal=function(){var menus=this.menus;$.each(menus,function(k,menu){var m=menu.dropPanel||menu.dropList||menu.modal;if(m&&m.hide){m.hide()}})}});_e(function(E,$){var ieRange=!E.w3cRange;function emptyFn(){}E.fn.currentRange=function(cr){if(cr){this._rangeData=cr}else{return this._rangeData}};E.fn.collapseRange=function(range,opt){opt=opt||'end';opt=opt==='start'?true:false;range=range||this.currentRange();if(range){range.collapse(opt);this.currentRange(range)}};E.fn.getRangeText=ieRange?emptyFn:function(range){range=range||this.currentRange();if(!range){return}return range.toString()};E.fn.getRangeElem=ieRange?emptyFn:function(range){range=range||this.currentRange();var dom=range.commonAncestorContainer;if(dom.nodeType===1){return dom}else{return dom.parentNode}};E.fn.isRangeEmpty=ieRange?emptyFn:function(range){range=range||this.currentRange();if(range&&range.startContainer){if(range.startContainer===range.endContainer){if(range.startOffset===range.endOffset){return true}}}return false};E.fn.saveSelection=ieRange?emptyFn:function(range){var self=this,_parentElem,selection,txt=self.txt.$txt.get(0);if(range){_parentElem=range.commonAncestorContainer}else{selection=document.getSelection();if(selection.getRangeAt&&selection.rangeCount){range=document.getSelection().getRangeAt(0);_parentElem=range.commonAncestorContainer}}if(_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)){self.currentRange(range)}};E.fn.restoreSelection=ieRange?emptyFn:function(range){var selection;range=range||this.currentRange();if(!range){return}try{selection=document.getSelection();selection.removeAllRanges();selection.addRange(range)}catch(ex){E.error('执行 editor.restoreSelection 时，IE可能会有异常，不影响使用')}};E.fn.restoreSelectionByElem=ieRange?emptyFn:function(elem,opt){if(!elem){return}opt=opt||'end';this.setRangeByElem(elem);if(opt==='start'){this.collapseRange(this.currentRange(),'start')}if(opt==='end'){this.collapseRange(this.currentRange(),'end')}this.restoreSelection()};E.fn.initSelection=ieRange?emptyFn:function(){var editor=this;if(editor.currentRange()){return}var range;var $txt=editor.txt.$txt;var $firstChild=$txt.children().first();if($firstChild.length){editor.restoreSelectionByElem($firstChild.get(0))}};E.fn.setRangeByElem=ieRange?emptyFn:function(elem){var editor=this;var txtElem=editor.txt.$txt.get(0);if(!elem||!$.contains(txtElem,elem)){return}var firstTextNode=elem.firstChild;while(firstTextNode){if(firstTextNode.nodeType===3){break}firstTextNode=firstTextNode.firstChild}var lastTextNode=elem.lastChild;while(lastTextNode){if(lastTextNode.nodeType===3){break}lastTextNode=lastTextNode.lastChild}var range=document.createRange();if(firstTextNode&&lastTextNode){range.setStart(firstTextNode,0);range.setEnd(lastTextNode,lastTextNode.textContent.length)}else{range.setStart(elem,0);range.setEnd(elem,0)}editor.saveSelection(range)}});_e(function(E,$){E.fn.commandHooks=function(){var editor=this;var commandHooks={};commandHooks.insertHtml=function(html){var $elem=$(html);var rangeElem=editor.getRangeElem();var targetElem;targetElem=editor.getLegalTags(rangeElem);if(!targetElem){return}$(targetElem).after($elem)};editor.commandHooks=commandHooks}});_e(function(E,$){E.fn.command=function(e,commandName,commandValue,callback){var editor=this;var hooks;function commandFn(){if(!commandName){return}if(editor.queryCommandSupported(commandName)){document.execCommand(commandName,false,commandValue)}else{hooks=editor.commandHooks;if(commandName in hooks){hooks[commandName](commandValue)}}}this.customCommand(e,commandFn,callback)};E.fn.commandForElem=function(elemOpt,e,commandName,commandValue,callback){var selector;var check;if(typeof elemOpt==='string'){selector=elemOpt}else{selector=elemOpt.selector;check=elemOpt.check}var rangeElem=this.getRangeElem();rangeElem=this.getSelfOrParentByName(rangeElem,selector,check);if(rangeElem){this.setRangeByElem(rangeElem)}this.command(e,commandName,commandValue,callback)};E.fn.customCommand=function(e,commandFn,callback){var editor=this;var range=editor.currentRange();if(!range){e&&e.preventDefault();return}editor.undoRecord();this.restoreSelection(range);commandFn.call(editor);this.saveSelection();this.restoreSelection();if(callback&&typeof callback==='function'){callback.call(editor)}editor.txt.insertEmptyP();editor.txt.wrapImgAndText();editor.updateValue();editor.updateMenuStyle();function hidePanelAndModal(){editor.hideDropPanelAndModal()}setTimeout(hidePanelAndModal,200);if(e){e.preventDefault()}};E.fn.queryCommandValue=function(commandName){var result='';try{result=document.queryCommandValue(commandName)}catch(ex){}return result};E.fn.queryCommandState=function(commandName){var result=false;try{result=document.queryCommandState(commandName)}catch(ex){}return result};E.fn.queryCommandSupported=function(commandName){var result=false;try{result=document.queryCommandSupported(commandName)}catch(ex){}return result}});_e(function(E,$){var matchesSelector;function _matchesSelectorForIE(selector){var elem=this;var $elems=$(selector);var result=false;$elems.each(function(){if(this===elem){result=true;return false}});return result}E.fn.getLegalTags=function(elem){var legalTags=this.config.legalTags;if(!legalTags){E.error('配置项中缺少 legalTags 的配置');return}return this.getSelfOrParentByName(elem,legalTags)};E.fn.getSelfOrParentByName=function(elem,selector,check){if(!elem||!selector){return}if(!matchesSelector){matchesSelector=elem.webkitMatchesSelector||elem.mozMatchesSelector||elem.oMatchesSelector||elem.matchesSelector}if(!matchesSelector){matchesSelector=_matchesSelectorForIE}var txt=this.txt.$txt.get(0);while(elem&&txt!==elem&&$.contains(txt,elem)){if(matchesSelector.call(elem,selector)){if(!check){return elem}if(check(elem)){return elem}}elem=elem.parentNode}return}});_e(function(E,$){var length=20;function _getRedoList(editor){if(editor._redoList==null){editor._redoList=[]}return editor._redoList}function _getUndoList(editor){if(editor._undoList==null){editor._undoList=[]}return editor._undoList}function _handle(editor,data,type){var val=data.val;var html=editor.txt.$txt.html();if(val==null){return}if(val===html){if(type==='redo'){editor.redo();return}else if(type==='undo'){editor.undo();return}else{return}}editor.txt.$txt.html(val);editor.updateValue();if(editor.onchange&&typeof editor.onchange==='function'){editor.onchange.call(editor)}}E.fn.undoRecord=function(){var editor=this;var $txt=editor.txt.$txt;var val=$txt.html();var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);var currentVal=undoList.length?undoList[0]:'';if(val===currentVal.val){return}if(redoList.length){redoList=[]}undoList.unshift({range:editor.currentRange(),val:val});if(undoList.length>length){undoList.pop()}};E.fn.undo=function(){var editor=this;var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);if(!undoList.length){return}var data=undoList.shift();redoList.unshift(data);_handle(this,data,'undo')};E.fn.redo=function(){var editor=this;var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);if(!redoList.length){return}var data=redoList.shift();undoList.unshift(data);_handle(this,data,'redo')}});_e(function(E,$){E.fn.create=function(){var editor=this;if(!E.$body||E.$body.length===0){E.$body=$('body');E.$document=$(document);E.$window=$(window)}editor.addMenus();editor.renderMenus();editor.renderMenuContainer();editor.renderTxt();editor.renderEditorContainer();editor.eventMenus();editor.eventMenuContainer();editor.eventTxt();editor.readyHeadler();editor.initSelection();editor.$txt=editor.txt.$txt;var _plugins=E._plugins;if(_plugins&&_plugins.length){$.each(_plugins,function(k,val){val.call(editor)})}};E.fn.disable=function(){this.txt.$txt.removeAttr('contenteditable');this.disableMenusExcept();this._disabled=true};E.fn.enable=function(){this._disabled=false;this.txt.$txt.attr('contenteditable','true');this.enableMenusExcept()};E.fn.destroy=function(){var self=this;var $valueContainer=self.$valueContainer;var $editorContainer=self.$editorContainer;var valueNodeName=self.valueNodeName;if(valueNodeName==='div'){$valueContainer.removeAttr('contenteditable');$editorContainer.after($valueContainer);$editorContainer.hide()}else{$valueContainer.show();$editorContainer.hide()}};E.fn.undestroy=function(){var self=this;var $valueContainer=self.$valueContainer;var $editorContainer=self.$editorContainer;var $menuContainer=self.menuContainer.$menuContainer;var valueNodeName=self.valueNodeName;if(valueNodeName==='div'){$valueContainer.attr('contenteditable','true');$menuContainer.after($valueContainer);$editorContainer.show()}else{$valueContainer.hide();$editorContainer.show()}};E.fn.clear=function(){var editor=this;var $txt=editor.txt.$txt;$txt.html('<p><br></p>');editor.restoreSelectionByElem($txt.find('p').get(0))}});_e(function(E,$){var MenuContainer=function(editor){this.editor=editor;this.init()};MenuContainer.fn=MenuContainer.prototype;E.MenuContainer=MenuContainer});_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.init=function(){var self=this;var $menuContainer=$('<div class="wangEditor-menu-container clearfix"></div>');self.$menuContainer=$menuContainer;self.changeShadow()};MenuContainer.fn.changeShadow=function(){var $menuContainer=this.$menuContainer;var editor=this.editor;var $txt=editor.txt.$txt;$txt.on('scroll',function(){if($txt.scrollTop()>10){$menuContainer.addClass('wangEditor-menu-shadow')}else{$menuContainer.removeClass('wangEditor-menu-shadow')}})}});_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.render=function(){var $menuContainer=this.$menuContainer;var $editorContainer=this.editor.$editorContainer;$editorContainer.append($menuContainer)};MenuContainer.fn.height=function(){var $menuContainer=this.$menuContainer;return $menuContainer.height()};MenuContainer.fn.appendMenu=function(groupIdx,menu){this._addGroup(groupIdx);return this._addOneMenu(menu)};MenuContainer.fn._addGroup=function(groupIdx){var $menuContainer=this.$menuContainer;var $menuGroup;if(!this.$currentGroup||this.currentGroupIdx!==groupIdx){$menuGroup=$('<div class="menu-group clearfix"></div>');$menuContainer.append($menuGroup);this.$currentGroup=$menuGroup;this.currentGroupIdx=groupIdx}};MenuContainer.fn._addOneMenu=function(menu){var $menuNormal=menu.$domNormal;var $menuSelected=menu.$domSelected;var $menuGroup=this.$currentGroup;var $item=$('<div class="menu-item clearfix"></div>');$menuSelected.hide();$item.append($menuNormal).append($menuSelected);$menuGroup.append($item);return $item}});_e(function(E,$){var Menu=function(opt){this.editor=opt.editor;this.id=opt.id;this.title=opt.title;this.$domNormal=opt.$domNormal;this.$domSelected=opt.$domSelected||opt.$domNormal;this.commandName=opt.commandName;this.commandValue=opt.commandValue;this.commandNameSelected=opt.commandNameSelected||opt.commandName;this.commandValueSelected=opt.commandValueSelected||opt.commandValue};Menu.fn=Menu.prototype;E.Menu=Menu});_e(function(E,$){var Menu=E.Menu;Menu.fn.initUI=function(){var editor=this.editor;var uiConfig=editor.UI.menus;var menuId=this.id;var menuUI=uiConfig[menuId];if(this.$domNormal&&this.$domSelected){return}if(menuUI==null){E.warn('editor.UI配置中，没有菜单 "'+menuId+'" 的UI配置，只能取默认值');menuUI=uiConfig['default']}this.$domNormal=$(menuUI.normal);if(/^\./.test(menuUI.selected)){this.$domSelected=this.$domNormal.clone().addClass(menuUI.selected.slice(1))}else{this.$domSelected=$(menuUI.selected)}}});_e(function(E,$){var Menu=E.Menu;Menu.fn.render=function(groupIdx){this.initUI();var editor=this.editor;var menuContainer=editor.menuContainer;var $menuItem=menuContainer.appendMenu(groupIdx,this);var onRender=this.onRender;this._renderTip($menuItem);if(onRender&&typeof onRender==='function'){onRender.call(this)}};Menu.fn._renderTip=function($menuItem){var self=this;var editor=self.editor;var title=self.title;var $tip=$('<div class="menu-tip"></div>');var $tempDiv;if(!self.tipWidth){$tempDiv=$('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+title+'</p>');E.$body.append($tempDiv);editor.ready(function(){var editor=this;var titleWidth=$tempDiv.outerWidth()+5;var currentWidth=$tip.outerWidth();var currentMarginLeft=parseFloat($tip.css('margin-left'),10);$tempDiv.remove();$tempDiv=null;$tip.css({width:titleWidth,'margin-left':currentMarginLeft+(currentWidth-titleWidth)/2});self.tipWidth=titleWidth})}$tip.append(title);$menuItem.append($tip);function show(){$tip.show()}function hide(){$tip.hide()}var timeoutId;$menuItem.find('a').on('mouseenter',function(e){if(!self.active()&&!self.disabled()){timeoutId=setTimeout(show,200)}}).on('mouseleave',function(e){timeoutId&&clearTimeout(timeoutId);hide()}).on('click',hide)};Menu.fn.bindEvent=function(){var self=this;var $domNormal=self.$domNormal;var $domSelected=self.$domSelected;var clickEvent=self.clickEvent;if(!clickEvent){clickEvent=function(e){var dropObj=self.dropPanel||self.dropList||self.modal;if(dropObj&&dropObj.show){if(dropObj.isShowing){dropObj.hide()}else{dropObj.show()}return}var editor=self.editor;var commandName;var commandValue;var selected=self.selected;if(selected){commandName=self.commandNameSelected;commandValue=self.commandValueSelected}else{commandName=self.commandName;commandValue=self.commandValue}if(commandName){editor.command(e,commandName,commandValue)}else{E.warn('菜单 "'+self.id+'" 未定义click事件');e.preventDefault()}}}var clickEventSelected=self.clickEventSelected||clickEvent;$domNormal.click(function(e){if(!self.disabled()){clickEvent.call(self,e);self.updateSelected()}e.preventDefault()});$domSelected.click(function(e){if(!self.disabled()){clickEventSelected.call(self,e);self.updateSelected()}e.preventDefault()})};Menu.fn.updateSelected=function(){var self=this;var editor=self.editor;var updateSelectedEvent=self.updateSelectedEvent;if(!updateSelectedEvent){updateSelectedEvent=function(){var self=this;var editor=self.editor;var commandName=self.commandName;var commandValue=self.commandValue;if(commandValue){if(editor.queryCommandValue(commandName).toLowerCase()===commandValue.toLowerCase()){return true}}else if(editor.queryCommandState(commandName)){return true}return false}}var result=updateSelectedEvent.call(self);result=!!result;self.changeSelectedState(result)};Menu.fn.changeSelectedState=function(state){var self=this;var selected=self.selected;if(state!=null&&typeof state==='boolean'){if(selected===state){return}self.selected=state;if(state){self.$domNormal.hide();self.$domSelected.show()}else{self.$domNormal.show();self.$domSelected.hide()}}};Menu.fn.active=function(active){if(active==null){return this._activeState}this._activeState=active};Menu.fn.activeStyle=function(active){var selected=this.selected;var $dom=this.$domNormal;var $domSelected=this.$domSelected;if(active){$dom.addClass('active');$domSelected.addClass('active')}else{$dom.removeClass('active');$domSelected.removeClass('active')}this.active(active)};Menu.fn.disabled=function(opt){if(opt==null){return!!this._disabled}if(this._disabled===opt){return}var $dom=this.$domNormal;var $domSelected=this.$domSelected;if(opt){$dom.addClass('disable');$domSelected.addClass('disable')}else{$dom.removeClass('disable');$domSelected.removeClass('disable')}this._disabled=opt}});_e(function(E,$){var DropList=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.data=opt.data;this.tpl=opt.tpl;this.selectorForELemCommand=opt.selectorForELemCommand;this.beforeEvent=opt.beforeEvent;this.afterEvent=opt.afterEvent;this.init()};DropList.fn=DropList.prototype;E.DropList=DropList});_e(function(E,$){var DropList=E.DropList;DropList.fn.init=function(){var self=this;self.initDOM();self.bindEvent();self.initHideEvent()};DropList.fn.initDOM=function(){var self=this;var data=self.data;var tpl=self.tpl||'<span>{#title}</span>';var $list=$('<div class="wangEditor-drop-list clearfix"></div>');var itemContent;var $item;$.each(data,function(commandValue,title){itemContent=tpl.replace(/{#commandValue}/ig,commandValue).replace(/{#title}/ig,title);$item=$('<a href="#" commandValue="'+commandValue+'"></a>');$item.append(itemContent);$list.append($item)});self.$list=$list};DropList.fn.bindEvent=function(){var self=this;var editor=self.editor;var menu=self.menu;var commandName=menu.commandName;var selectorForELemCommand=self.selectorForELemCommand;var $list=self.$list;var beforeEvent=self.beforeEvent;var afterEvent=self.afterEvent;$list.on('click','a[commandValue]',function(e){if(beforeEvent&&typeof beforeEvent==='function'){beforeEvent.call(e)}var commandValue=$(e.currentTarget).attr('commandValue');if(menu.selected&&editor.isRangeEmpty()&&selectorForELemCommand){editor.commandForElem(selectorForELemCommand,e,commandName,commandValue)}else{editor.command(e,commandName,commandValue)}if(afterEvent&&typeof afterEvent==='function'){afterEvent.call(e)}})};DropList.fn.initHideEvent=function(){var self=this;var thisList=self.$list.get(0);E.$body.on('click',function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}if(thisList===trigger||$.contains(thisList,trigger)){return}self.hide()});E.$window.scroll(function(){self.hide()});E.$window.on('resize',function(){self.hide()})}});_e(function(E,$){var DropList=E.DropList;DropList.fn._render=function(){var self=this;var editor=self.editor;var $list=self.$list;editor.$editorContainer.append($list);self.rendered=true};DropList.fn._position=function(){var self=this;var $list=self.$list;var editor=self.editor;var menu=self.menu;var $menuContainer=editor.menuContainer.$menuContainer;var $menuDom=menu.selected?menu.$domSelected:menu.$domNormal;var menuPosition=$menuDom.offsetParent().position();var menuTop=menuPosition.top;var menuLeft=menuPosition.left;var menuHeight=$menuDom.offsetParent().height();var menuWidth=$menuDom.offsetParent().width();var listWidth=$list.outerWidth();var txtWidth=editor.txt.$txt.outerWidth();var top=menuTop+menuHeight;var left=menuLeft+menuWidth/2;var marginLeft=0-menuWidth/2;var valWithTxt=(left+listWidth)-txtWidth;if(valWithTxt>-10){marginLeft=marginLeft-valWithTxt-10}$list.css({top:top,left:left,'margin-left':marginLeft});if(editor._isMenufixed){top=top+(($menuContainer.offset().top+$menuContainer.outerHeight())-$list.offset().top);$list.css({top:top})}};DropList.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}var $list=self.$list;$list.show();self._position();self.isShowing=true;menu.activeStyle(true)};DropList.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}var $list=self.$list;$list.hide();self.isShowing=false;menu.activeStyle(false)}});_e(function(E,$){var DropPanel=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.$content=opt.$content;this.width=opt.width||200;this.height=opt.height;this.onRender=opt.onRender;this.init()};DropPanel.fn=DropPanel.prototype;E.DropPanel=DropPanel});_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn.init=function(){var self=this;self.initDOM();self.initHideEvent()};DropPanel.fn.initDOM=function(){var self=this;var $content=self.$content;var width=self.width;var height=self.height;var $panel=$('<div class="wangEditor-drop-panel clearfix"></div>');var $triangle=$('<div class="tip-triangle"></div>');$panel.css({width:width,height:height?height:'auto'});$panel.append($triangle);$panel.append($content);self.$panel=$panel;self.$triangle=$triangle};DropPanel.fn.initHideEvent=function(){var self=this;var thisPanle=self.$panel.get(0);E.$body.on('click',function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}if(thisPanle===trigger||$.contains(thisPanle,trigger)){return}self.hide()});E.$window.scroll(function(e){self.hide()});E.$window.on('resize',function(){self.hide()})}});_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn._render=function(){var self=this;var onRender=self.onRender;var editor=self.editor;var $panel=self.$panel;editor.$editorContainer.append($panel);onRender&&onRender.call(self);self.rendered=true};DropPanel.fn._position=function(){var self=this;var $panel=self.$panel;var $triangle=self.$triangle;var editor=self.editor;var $menuContainer=editor.menuContainer.$menuContainer;var menu=self.menu;var $menuDom=menu.selected?menu.$domSelected:menu.$domNormal;var menuPosition=$menuDom.offsetParent().position();var menuTop=menuPosition.top;var menuLeft=menuPosition.left;var menuHeight=$menuDom.offsetParent().height();var menuWidth=$menuDom.offsetParent().width();var panelWidth=$panel.outerWidth();var txtWidth=editor.txt.$txt.outerWidth();var top=menuTop+menuHeight;var left=menuLeft+menuWidth/2;var marginLeft=0-panelWidth/2;var marginLeft2=marginLeft;if((0-marginLeft)>(left-10)){marginLeft=0-(left-10)}var valWithTxt=(left+panelWidth+marginLeft)-txtWidth;if(valWithTxt>-10){marginLeft=marginLeft-valWithTxt-10}$panel.css({top:top,left:left,'margin-left':marginLeft});if(editor._isMenufixed){top=top+(($menuContainer.offset().top+$menuContainer.outerHeight())-$panel.offset().top);$panel.css({top:top})}$triangle.css({'margin-left':marginLeft2-marginLeft-5})};DropPanel.fn.focusFirstInput=function(){var self=this;var $panel=self.$panel;$panel.find('input[type=text],textarea').each(function(){var $input=$(this);if($input.attr('disabled')==null){$input.focus();return false}})};DropPanel.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}var $panel=self.$panel;$panel.show();self._position();self.isShowing=true;menu.activeStyle(true);if(E.w3cRange){self.focusFirstInput()}else{E.placeholderForIE8($panel)}};DropPanel.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}var $panel=self.$panel;$panel.hide();self.isShowing=false;menu.activeStyle(false)}});_e(function(E,$){var Txt=function(editor){this.editor=editor;this.init()};Txt.fn=Txt.prototype;E.Txt=Txt});_e(function(E,$){var Txt=E.Txt;Txt.fn.init=function(){var self=this;var editor=self.editor;var $valueContainer=editor.$valueContainer;var currentValue=editor.getInitValue();var $txt;if($valueContainer.get(0).nodeName==='DIV'){$txt=$valueContainer;$txt.addClass("wangEditor-txt");$txt.attr('contentEditable','true')}else{$txt=$('<div class="wangEditor-txt" contentEditable="true">'+currentValue+'</div>')}editor.ready(function(){self.insertEmptyP()});self.$txt=$txt;self.contentEmptyHandle();self.bindEnterForDiv();self.bindEnterForText();self.bindTabEvent();self.bindPasteFilter();self.bindFormatText();self.bindHtml()};Txt.fn.contentEmptyHandle=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var $p;$txt.on('keydown',function(e){if(e.keyCode!==8){return}var txtHtml=$.trim($txt.html().toLowerCase());if(txtHtml==='<p><br></p>'){e.preventDefault();return}});$txt.on('keyup',function(e){if(e.keyCode!==8){return}var txtHtml=$.trim($txt.html().toLowerCase());if(!txtHtml||txtHtml==='<br>'){$p=$('<p><br/></p>');$txt.html('');$txt.append($p);editor.restoreSelectionByElem($p.get(0))}})};Txt.fn.bindEnterForDiv=function(){var tags=E.config.legalTags;var self=this;var editor=self.editor;var $txt=self.$txt;var $keydownDivElem;function divHandler(){if(!$keydownDivElem){return}var $pElem=$('<p>'+$keydownDivElem.html()+'</p>');$keydownDivElem.after($pElem);$keydownDivElem.remove()}$txt.on('keydown keyup',function(e){if(e.keyCode!==13){return}var rangeElem=editor.getRangeElem();var targetElem=editor.getLegalTags(rangeElem);var $targetElem;var $pElem;if(!targetElem){targetElem=editor.getSelfOrParentByName(rangeElem,'div');if(!targetElem){return}$targetElem=$(targetElem);if(e.type==='keydown'){$keydownDivElem=$targetElem;setTimeout(divHandler,0)}if(e.type==='keyup'){$pElem=$('<p>'+$targetElem.html()+'</p>');$targetElem.after($pElem);$targetElem.remove();editor.restoreSelectionByElem($pElem.get(0),'start')}}})};Txt.fn.bindEnterForText=function(){var self=this;var $txt=self.$txt;var handle;$txt.on('keyup',function(e){if(e.keyCode!==13){return}if(!handle){handle=function(){self.wrapImgAndText()}}setTimeout(handle)})};Txt.fn.bindTabEvent=function(){var self=this;var editor=self.editor;var $txt=self.$txt;$txt.on('keydown',function(e){if(e.keyCode!==9){return}if(editor.queryCommandSupported('insertHtml')){editor.command(e,'insertHtml','&nbsp;&nbsp;&nbsp;&nbsp;')}})};Txt.fn.bindPasteFilter=function(){var self=this;var editor=self.editor;var resultHtml='';var $txt=self.$txt;var legalTags=editor.config.legalTags;var legalTagArr=legalTags.split(',');$txt.on('paste',function(e){if(!editor.config.pasteFilter){return}var currentNodeName=editor.getRangeElem().nodeName;if(currentNodeName==='TD'||currentNodeName==='TH'){return}resultHtml='';var pasteHtml,$paste;var data=e.clipboardData||e.originalEvent.clipboardData;var ieData=window.clipboardData;if(editor.config.pasteText){if(data&&data.getData){pasteHtml=data.getData('text/plain')}else if(ieData&&ieData.getData){pasteHtml=ieData.getData('text')}else{return}if(pasteHtml){resultHtml='<p>'+pasteHtml+'</p>'}}else{if(data&&data.getData){pasteHtml=data.getData('text/html');if(pasteHtml){$paste=$('<div>'+pasteHtml+'</div>');handle($paste.get(0))}else{pasteHtml=data.getData('text/plain');if(pasteHtml){pasteHtml=pasteHtml.replace(/[ ]/g,'&nbsp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'</p><p>');resultHtml='<p>'+pasteHtml+'</p>';resultHtml=resultHtml.replace(/<p>(https?:\/\/.*?)<\/p>/ig,function(match,link){return'<p><a href="'+link+'" target="_blank">'+link+'</p>'})}}}else if(ieData&&ieData.getData){resultHtml=ieData.getData('text');if(!resultHtml){return}resultHtml='<p>'+resultHtml+'</p>';resultHtml=resultHtml.replace((new RegExp('\n','g'),'</p><p>'))}else{return}}if(resultHtml){editor.command(e,'insertHtml',resultHtml);self.clearEmptyOrNestP()}});function handle(elem){if(!elem||!elem.nodeType||!elem.nodeName){return}var $elem;var nodeName=elem.nodeName.toLowerCase();var nodeType=elem.nodeType;if(nodeType!==3&&nodeType!==1){return}$elem=$(elem);if(nodeName==='div'){$.each(elem.childNodes,function(){handle(this)});return}if(legalTagArr.indexOf(nodeName)>=0){resultHtml+=getResult(elem)}else if(nodeType===3){resultHtml+='<p>'+elem.textContent+'</p>'}else if(nodeName==='br'){resultHtml+='<br/>'}else{if(['meta','style','script','object','form','iframe','hr'].indexOf(nodeName)>=0){return}$elem=$(removeAttrs(elem));resultHtml+=$('<div>').append($elem.clone()).html()}}function getResult(elem){var nodeName=elem.nodeName.toLowerCase();var $elem;var htmlForP='';var htmlForLi='';if(['blockquote'].indexOf(nodeName)>=0){$elem=$(elem);return'<'+nodeName+'>'+$elem.text()+'</'+nodeName+'>'}else if(['p','h1','h2','h3','h4','h5'].indexOf(nodeName)>=0){elem=removeAttrs(elem);$elem=$(elem);htmlForP=$elem.html();htmlForP=htmlForP.replace(/<.*?>/ig,function(tag){if(tag==='</a>'||tag.indexOf('<a ')===0||tag.indexOf('<img ')===0){return tag}else{return''}});return'<'+nodeName+'>'+htmlForP+'</'+nodeName+'>'}else if(['ul','ol'].indexOf(nodeName)>=0){$elem=$(elem);$elem.children().each(function(){var $li=$(removeAttrs(this));var html=$li.html();html=html.replace(/<.*?>/ig,function(tag){if(tag==='</a>'||tag.indexOf('<a ')===0||tag.indexOf('<img ')===0){return tag}else{return''}});htmlForLi+='<li>'+html+'</li>'});return'<'+nodeName+'>'+htmlForLi+'</'+nodeName+'>'}else{$elem=$(removeAttrs(elem));return $('<div>').append($elem).html()}}function removeAttrs(elem){var attrs=elem.attributes||[];var attrNames=[];var exception=['href','target','src','alt','rowspan','colspan'];$.each(attrs,function(key,attr){if(attr&&attr.nodeType===2){attrNames.push(attr.nodeName)}});$.each(attrNames,function(key,attr){if(exception.indexOf(attr)<0){elem.removeAttribute(attr)}});var children=elem.childNodes;if(children.length){$.each(children,function(key,value){removeAttrs(value)})}return elem}};Txt.fn.bindFormatText=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var legalTags=E.config.legalTags;var legalTagArr=legalTags.split(',');var length=legalTagArr.length;var regArr=[];$.each(legalTagArr,function(k,tag){var reg='\>\\s*\<('+tag+')\>';regArr.push(new RegExp(reg,'ig'))});regArr.push(new RegExp('\>\\s*\<(li)\>','ig'));regArr.push(new RegExp('\>\\s*\<(tr)\>','ig'));regArr.push(new RegExp('\>\\s*\<(code)\>','ig'));$txt.formatText=function(){var $temp=$('<div>');var html=$txt.html();html=html.replace(/\s*</ig,'<');$.each(regArr,function(k,reg){if(!reg.test(html)){return}html=html.replace(reg,function(matchStr,tag){return'>\n<'+tag+'>'})});$temp.html(html);return $temp.text()}};Txt.fn.bindHtml=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var $valueContainer=editor.$valueContainer;var valueNodeName=editor.valueNodeName;$txt.html=function(html){var result;if(valueNodeName==='div'){result=$.fn.html.call($txt,html)}if(html===undefined){result=$.fn.html.call($txt);result=result.replace(/(href|src)\=\"(.*)\"/igm,function(a,b,c){return b+'="'+c.replace('&amp;','&')+'"'})}else{result=$.fn.html.call($txt,html);$valueContainer.val(html)}if(html===undefined){return result}else{$txt.change()}}}});_e(function(E,$){var Txt=E.Txt;var txtChangeEventNames='propertychange change click keyup input paste';Txt.fn.render=function(){var $txt=this.$txt;var $editorContainer=this.editor.$editorContainer;$editorContainer.append($txt)};Txt.fn.initHeight=function(){var editor=this.editor;var $txt=this.$txt;var valueContainerHeight=editor.$valueContainer.height();var menuHeight=editor.menuContainer.height();var txtHeight=valueContainerHeight-menuHeight;txtHeight=txtHeight<50?50:txtHeight;$txt.height(txtHeight);editor.valueContainerHeight=valueContainerHeight;this.initMaxHeight(txtHeight,menuHeight)};Txt.fn.initMaxHeight=function(txtHeight,menuHeight){var editor=this.editor;var $menuContainer=editor.menuContainer.$menuContainer;var $txt=this.$txt;var $wrap=$('<div>');if(window.getComputedStyle&&'max-height'in window.getComputedStyle($txt.get(0))){var maxHeight=parseInt(editor.$valueContainer.css('max-height'));if(isNaN(maxHeight)){return}if(editor.menus.fullscreen){E.warn('max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用');return}editor.useMaxHeight=true;$wrap.css({'max-height':(maxHeight-menuHeight)+'px','overflow-y':'auto'});$txt.css({'height':'auto','overflow-y':'visible','min-height':txtHeight+'px'});$wrap.on('scroll',function(){if($txt.parent().scrollTop()>10){$menuContainer.addClass('wangEditor-menu-shadow')}else{$menuContainer.removeClass('wangEditor-menu-shadow')}});$txt.wrap($wrap)}};Txt.fn.saveSelectionEvent=function(){var $txt=this.$txt;var editor=this.editor;var timeoutId;var dt=Date.now();function save(){editor.saveSelection()}function saveSync(){if(Date.now()-dt<100){return}dt=Date.now();save()}function saveAync(){if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(save,300)}$txt.on(txtChangeEventNames+' focus blur',function(e){saveSync();saveAync()});$txt.on('mousedown',function(){$txt.on('mouseleave.saveSelection',function(e){saveSync();saveAync();editor.updateMenuStyle()})}).on('mouseup',function(){$txt.off('mouseleave.saveSelection')})};Txt.fn.updateValueEvent=function(){var $txt=this.$txt;var editor=this.editor;var timeoutId,oldValue;function doOnchange(){var val=$txt.html();if(oldValue===val){return}if(editor.onchange&&typeof editor.onchange==='function'){editor.onchange.call(editor)}editor.updateValue();oldValue=val}$txt.on(txtChangeEventNames,function(e){if(oldValue==null){oldValue=$txt.html()}if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(doOnchange,100)})};Txt.fn.updateMenuStyleEvent=function(){var $txt=this.$txt;var editor=this.editor;$txt.on(txtChangeEventNames,function(e){editor.updateMenuStyle()})};Txt.fn.insertEmptyP=function(){var $txt=this.$txt;var $children=$txt.children();if($children.length===0){$txt.append($('<p><br></p>'));return}if($.trim($children.last().html()).toLowerCase()!=='<br>'){$txt.append($('<p><br></p>'))}};Txt.fn.wrapImgAndText=function(){var $txt=this.$txt;var $imgs=$txt.children('img');var txt=$txt[0];var childNodes=txt.childNodes;var childrenLength=childNodes.length;var i,childNode,p;$imgs.length&&$imgs.each(function(){$(this).wrap('<p>')});for(i=0;i<childrenLength;i++){childNode=childNodes[i];if(childNode.nodeType===3&&childNode.textContent&&$.trim(childNode.textContent)){$(childNode).wrap('<p>')}}};Txt.fn.clearEmptyOrNestP=function(){var $txt=this.$txt;var $pList=$txt.find('p');$pList.each(function(){var $p=$(this);var $children=$p.children();var childrenLength=$children.length;var $firstChild;var content=$.trim($p.html());if(!content){$p.remove();return}if(childrenLength===1){$firstChild=$children.first();if($firstChild.get(0)&&$firstChild.get(0).nodeName==='P'){$p.html($firstChild.html())}}})};Txt.fn.scrollTop=function(val){var self=this;var editor=self.editor;var $txt=self.$txt;if(editor.useMaxHeight){return $txt.parent().scrollTop(val)}else{return $txt.scrollTop(val)}};Txt.fn.showHeightOnHover=function(){var editor=this.editor;var $editorContainer=editor.$editorContainer;var menuContainer=editor.menuContainer;var $txt=this.$txt;var $tip=$('<i class="height-tip"><i>');var isTipInTxt=false;function addAndShowTip($target){if(!isTipInTxt){$editorContainer.append($tip);isTipInTxt=true}var txtTop=$txt.position().top;var txtHeight=$txt.outerHeight();var height=$target.height();var top=$target.position().top;var marginTop=parseInt($target.css('margin-top'),10);var paddingTop=parseInt($target.css('padding-top'),10);var marginBottom=parseInt($target.css('margin-bottom'),10);var paddingBottom=parseInt($target.css('padding-bottom'),10);var resultHeight=height+paddingTop+marginTop+paddingBottom+marginBottom;var resultTop=top+menuContainer.height();$tip.css({height:height+paddingTop+marginTop+paddingBottom+marginBottom,top:top+menuContainer.height()})}function removeTip(){if(!isTipInTxt){return}$tip.remove();isTipInTxt=false}$txt.on('mouseenter','ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre',function(e){addAndShowTip($(e.currentTarget))}).on('mouseleave',function(){removeTip()})}});_e(function(E,$){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elem){var i=0,length=this.length;for(;i<length;i++){if(this[i]===elem){return i}}return-1};Array.prototype.lastIndexOf=function(elem){var length=this.length;for(length=length-1;length>=0;length--){if(this[length]===elem){return length}}return-1}}if(!Date.now){Date.now=function(){return new Date().valueOf()}}var console=window.console;var emptyFn=function(){};$.each(['info','log','warn','error'],function(key,value){if(console==null){E[value]=emptyFn}else{E[value]=function(info){if(E.config&&E.config.printLog){console[value]('wangEditor提示: '+info)}}}});E.random=function(){return Math.random().toString().slice(2)};E.placeholder='placeholder'in document.createElement('input');E.placeholderForIE8=function($container){if(E.placeholder){return}$container.find('input[placeholder]').each(function(){var $input=$(this);var placeholder=$input.attr('placeholder');if($input.val()===''){$input.css('color','#666');$input.val(placeholder);$input.on('focus.placeholder click.placeholder',function(){$input.val('');$input.css('color','#333');$input.off('focus.placeholder click.placeholder')})}})}});_e(function(E,$){E.langs={};E.langs['zh-cn']={bold:"粗体/Ctrl+B",underline:"下划线/Ctrl+U",italic:"斜体/Ctrl+I",strikethrough:"删除线",eraser:"清除格式",undo:"Ctrl+Z",forecolor:"文字颜色",head:"字体大小",}});_e(function(E,$){E.config={};E.config.jsFilter=true;E.config.legalTags='p,h1,h2,h3,h4,h5,h6,table,ul,ol';E.config.lang=E.langs['zh-cn'];E.config.menus=["bold","underline","italic","strikethrough","head","forecolor","undo","eraser",];E.config.colors={'#880000':'棕红色','#673AB7':'紫色','#F44336':'红色','#ff00ff':'鲜粉色','#1565C0':'深蓝色','#03A9F4':'湖蓝色','#00BFA5':'蓝绿色','#4CAF50':'绿色','#64DD17':'浅绿色','#FF9800':'橙黄色','#808080':'灰色','#c0c0c0':'银色',};E.config.pasteFilter=true});_e(function(E,$){E.UI={};E.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1" style="font-weight:bold;font-size:15px">B</a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1" style="text-decoration:underline;font-size:15px">U</a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1" style="font-size:15px;font-style:italic">I</a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1" style="font-size:15px;text-decoration:line-through">S</a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"  style="font-size:12px;margin-top:2px">清除</a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1" style="font-size:12px;margin-top:2px">撤销</a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1" style="font-size:12px;margin-top:2px">颜色</a>',selected:'.selected'},head:{normal:'<a href="#" tabindex="-1" style="font-size:12px;margin-top:2px">字号</a>',selected:'.selected'}}});_e(function(E,$){E.fn.initDefaultConfig=function(){var editor=this;editor.config=$.extend({},E.config);editor.UI=$.extend({},E.UI)}});_e(function(E,$){E.fn.addEditorContainer=function(){this.$editorContainer=$('<div class="wangEditor-container"></div>')}});_e(function(E,$){E.fn.addTxt=function(){var editor=this;var txt=new E.Txt(editor);editor.txt=txt}});_e(function(E,$){E.fn.addMenuContainer=function(){var editor=this;editor.menuContainer=new E.MenuContainer(editor)}});_e(function(E,$){E.createMenuFns=[];E.createMenu=function(fn){E.createMenuFns.push(fn)};E.fn.addMenus=function(){var editor=this;var menuIds=editor.config.menus;function check(menuId){if(menuIds.indexOf(menuId)>=0){return true}return false}$.each(E.createMenuFns,function(k,createMenuFn){createMenuFn.call(editor,check)})}});_e(function(E,$){E.createMenu(function(check){var menuId='bold';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.bold,commandName:'Bold'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'Bold')}else{editor.commandForElem('b,strong,h1,h2,h3,h4,h5',e,'Bold')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='underline';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.underline,commandName:'Underline'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'Underline')}else{editor.commandForElem('u,a',e,'Underline')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='italic';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.italic,commandName:'Italic'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'Italic')}else{editor.commandForElem('i',e,'Italic')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='forecolor';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configColors=editor.config.colors;var menu=new E.Menu({editor:editor,id:menuId,title:lang.forecolor});var $content=$('<div></div>');$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item" ','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ','><b>T</b></a>'].join(''))});$content.on('click','a[commandValue]',function(e){var $elem=$(this);var commandValue=$elem.attr('commandValue');if(menu.selected&&editor.isRangeEmpty()){editor.commandForElem('font[color]',e,'forecolor',commandValue)}else{editor.command(e,'forecolor',commandValue)}});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'font[color]');if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='strikethrough';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.strikethrough,commandName:'StrikeThrough'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'StrikeThrough')}else{editor.commandForElem('strike',e,'StrikeThrough')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='eraser';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.eraser,commandName:'RemoveFormat'});menu.clickEvent=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'RemoveFormat');return}var $clearElem;function commandFn(){var editor=this;var rangeElem;var pElem,$pElem;var quoteElem,$quoteElem;var listElem,$listElem;rangeElem=editor.getRangeElem();quoteElem=editor.getSelfOrParentByName(rangeElem,'blockquote');if(quoteElem){$quoteElem=$(quoteElem);$clearElem=$('<p>'+$quoteElem.text()+'</p>');$quoteElem.after($clearElem).remove()}pElem=editor.getSelfOrParentByName(rangeElem,'p,h1,h2,h3,h4,h5');if(pElem){$pElem=$(pElem);$clearElem=$('<p>'+$pElem.text()+'</p>');$pElem.after($clearElem).remove()}listElem=editor.getSelfOrParentByName(rangeElem,'ul,ol');if(listElem){$listElem=$(listElem);$clearElem=$('<p>'+$listElem.text()+'</p>');$listElem.after($clearElem).remove()}}function callback(){var editor=this;if($clearElem){editor.restoreSelectionByElem($clearElem.get(0))}}editor.customCommand(e,commandFn,callback)};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='head';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.head,commandName:'formatBlock'});var data={'<h1>':'标题1','<h2>':'标题2','<h3>':'标题3','<h4>':'标题4','<h5>':'标题5'};var isOrderedList;function beforeEvent(e){if(editor.queryCommandState('InsertOrderedList')){isOrderedList=true;editor.command(e,'InsertOrderedList')}else{isOrderedList=false}}function afterEvent(e){if(isOrderedList){editor.command(e,'InsertOrderedList')}}var tpl='{#commandValue}{#title}';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,beforeEvent:beforeEvent,afterEvent:afterEvent});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'h1,h2,h3,h4,h5');if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='undo';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.undo});menu.clickEvent=function(e){editor.undo()};editor.menus[menuId]=menu;editor.ready(function(){var editor=this;var $txt=editor.txt.$txt;var timeoutId;function undo(){editor.undoRecord()}$txt.on('keydown',function(e){var keyCode=e.keyCode;if(e.ctrlKey&&keyCode===90){editor.undo();return}if(keyCode===13){undo()}else{if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(undo,1000)}});editor.undoRecord()})})});_e(function(E,$){E.fn.renderMenus=function(){var editor=this;var menus=editor.menus;var menuIds=editor.config.menus;var menuContainer=editor.menuContainer;var menu;var groupIdx=0;$.each(menuIds,function(k,v){if(v==='|'){groupIdx++;return}menu=menus[v];if(menu){menu.render(groupIdx)}})}});_e(function(E,$){E.fn.renderMenuContainer=function(){var editor=this;var menuContainer=editor.menuContainer;var $editorContainer=editor.$editorContainer;menuContainer.render()}});_e(function(E,$){E.fn.renderTxt=function(){var editor=this;var txt=editor.txt;txt.render();editor.ready(function(){txt.initHeight()})}});_e(function(E,$){E.fn.renderEditorContainer=function(){var editor=this;var $valueContainer=editor.$valueContainer;var $editorContainer=editor.$editorContainer;var $txt=editor.txt.$txt;var $prev,$parent;if($valueContainer===$txt){$prev=editor.$prev;$parent=editor.$parent;if($prev&&$prev.length){$prev.after($editorContainer)}else{$parent.prepend($editorContainer)}}else{$valueContainer.after($editorContainer);$valueContainer.hide()}}});_e(function(E,$){E.fn.eventMenus=function(){var menus=this.menus;$.each(menus,function(k,v){v.bindEvent()})}});_e(function(E,$){E.fn.eventMenuContainer=function(){}});_e(function(E,$){E.fn.eventTxt=function(){var txt=this.txt;txt.saveSelectionEvent();txt.updateValueEvent();txt.updateMenuStyleEvent()}});return window.wangEditor});